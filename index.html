<!DOCTYPE html>
<html>
<head>
  <title>Cloudix Dynamic S3 Dashboard</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .file-list { display: flex; flex-wrap: wrap; gap: 10px; }
    .file-item { border: 1px solid #ccc; padding: 10px; border-radius: 5px; width: 200px; word-wrap: break-word; }
    .file-item img { max-width: 100%; height: auto; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Cloudix File Dashboard</h1>
  <div id="file-list" class="file-list">Loading files...</div>

  <script>
    const s3BucketUrl = "https://cloudix-sharing.s3.amazonaws.com/?list-type=2";

    fetch(s3BucketUrl)
      .then(res => res.text())
      .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
      .then(data => {
        const contents = data.getElementsByTagName("Contents");
        const container = document.getElementById("file-list");
        container.innerHTML = "";

        Array.from(contents).forEach(item => {
          const key = item.getElementsByTagName("Key")[0].textContent;
          const fileUrl = "https://cloudix-sharing.s3.amazonaws.com/" + key;
          const isImage = /\.(jpg|jpeg|png|webp|gif)$/i.test(key);

          const div = document.createElement("div");
          div.className = "file-item";

          if (isImage) {
            div.innerHTML = `<img src="${fileUrl}"><a href="${fileUrl}" target="_blank">${key}</a>`;
          } else {
            div.innerHTML = `<a href="${fileUrl}" target="_blank">${key}</a>`;
          }

          container.appendChild(div);
        });
      })
      .catch(err => {
        document.getElementById("file-list").innerText = "Error loading files.";
        console.error(err);
      });
  </script>
</body>
</html>

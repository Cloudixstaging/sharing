<!DOCTYPE html>
<html>
<head>
  <title>Cloudix S3 Dashboard</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h1 { font-size: 26px; }
    .file-list { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
    .file-item {
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 6px;
      width: 200px;
      word-wrap: break-word;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .file-item img {
      max-width: 100%;
      height: auto;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h1>Cloudix File Dashboard</h1>
  <div id="file-list" class="file-list">Loading files...</div>

  <script>
    const s3BucketBase = "https://cloudix-sharing.s3.ap-southeast-1.amazonaws.com/";
    const s3ListUrl = s3BucketBase + "?list-type=2";

    fetch(s3ListUrl)
      .then(res => res.text())
      .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
      .then(data => {
        const contents = data.getElementsByTagName("Contents");
        const listContainer = document.getElementById("file-list");
        listContainer.innerHTML = "";

        Array.from(contents).forEach(item => {
          const key = item.getElementsByTagName("Key")[0].textContent;
          const fileUrl = s3BucketBase + encodeURIComponent(key);
          const isImage = /\.(jpg|jpeg|png|gif|webp)$/i.test(key);

          const div = document.createElement("div");
          div.className = "file-item";

          if (isImage) {
            div.innerHTML = `<img src="${fileUrl}"><a href="${fileUrl}" target="_blank">${key}</a>`;
          } else {
            div.innerHTML = `<a href="${fileUrl}" target="_blank">${key}</a>`;
          }

          listContainer.appendChild(div);
        });
      })
      .catch(err => {
        document.getElementById("file-list").innerText = "Error loading files.";
        console.error(err);
      });
  </script>
</body>
</html>

